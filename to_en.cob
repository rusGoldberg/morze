IDENTIFICATION DIVISION.
PROGRAM-ID. TextToMorse.
AUTHOR. rusGoldberg@gmail.com.

ENVIRONMENT DIVISION.
CONFIGURATION SECTION.
SOURCE-COMPUTER. IBM-370.
OBJECT-COMPUTER. IBM-370.

DATA DIVISION.
WORKING-STORAGE SECTION.
01 WS-INPUT-TEXT          PIC X(100).
01 WS-OUTPUT-MORSE        PIC X(500) VALUE SPACES.
01 WS-CURRENT-CHAR        PIC X.
01 WS-MORSE-CODE          PIC X(7).
01 WS-INPUT-LENGTH        PIC 9(3).
01 WS-OUTPUT-INDEX        PIC 9(3) VALUE 1.

01 MORSE-TABLE.
   05 MORSE-ENTRIES OCCURS 45 TIMES INDEXED BY MIDX.
      10 MORSE-CHAR       PIC X.
      10 MORSE-CODE       PIC X(7).

01 ERROR-FLAG             PIC X VALUE 'N'.
   88 VALID-CHAR          VALUE 'N'.
   88 INVALID-CHAR        VALUE 'Y'.

PROCEDURE DIVISION.
INITIALIZE-MORSE-TABLE.
   MOVE 'A'  TO MORSE-CHAR(1)   MOVE '.- '     TO MORSE-CODE(1)
   MOVE 'B'  TO MORSE-CHAR(2)   MOVE '-... '   TO MORSE-CODE(2)
   ... [полный список символов] ...
   MOVE '='  TO MORSE-CHAR(45)  MOVE '-...- '  TO MORSE-CODE(45).

MAIN-LOGIC.
   PERFORM INITIALIZE-MORSE-TABLE
   DISPLAY "Введите текст: " WITH NO ADVANCING
   ACCEPT WS-INPUT-TEXT
   MOVE FUNCTION UPPER-CASE(WS-INPUT-TEXT) TO WS-INPUT-TEXT
   MOVE FUNCTION LENGTH(WS-INPUT-TEXT) TO WS-INPUT-LENGTH
   PERFORM PROCESS-CHARACTER
      VARYING WS-OUTPUT-INDEX FROM 1 BY 1
      UNTIL WS-OUTPUT-INDEX > WS-INPUT-LENGTH
   IF INVALID-CHAR
      DISPLAY "Обнаружены неподдерживаемые символы!"
   END-IF
   DISPLAY "Код Морзе: " WS-OUTPUT-MORSE
   STOP RUN.

PROCESS-CHARACTER.
   MOVE WS-INPUT-TEXT(WS-OUTPUT-INDEX:1) TO WS-CURRENT-CHAR
   SET VALID-CHAR TO TRUE
   PERFORM FIND-MORSE-CODE
   IF VALID-CHAR
      STRING MORSE-CODE(MIDX) DELIMITED BY SPACE
        INTO WS-OUTPUT-MORSE
        WITH POINTER WS-OUTPUT-INDEX
   ELSE
      SET INVALID-CHAR TO TRUE
      MOVE '? ' TO WS-OUTPUT-MORSE(WS-OUTPUT-INDEX:2)
      ADD 2 TO WS-OUTPUT-INDEX
   END-IF.

FIND-MORSE-CODE.
   SET MIDX TO 1
   SEARCH MORSE-ENTRIES
      AT END SET INVALID-CHAR TO TRUE
      WHEN MORSE-CHAR(MIDX) = WS-CURRENT-CHAR
         CONTINUE
   END-SEARCH.
